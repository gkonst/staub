<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<ui:composition template="/template/staub-template.jspx">
<ui:param name="pageBean" value="#{questionDetailBean}"/>
<!--@elvariable id="pageBean" type="ru.spbspu.staub.bean.question.QuestionDetailBean"-->
<!--@elvariable id="messages" type="java.util.Map"-->
<ui:define name="sidebar">
    <ui:include src="/system/menuPage.jspx"/>
</ui:define>
<ui:define name="contentTitle">
    #{messages['question.detail.title']}
</ui:define>
<ui:define name="contentBody">
<a4j:form id="questionDetailForm">
<a4j:outputPanel id="contentButtons" styleClass="contentButtons">
    <ui:include src="/controls/genericSaveControl.jspx"/>
</a4j:outputPanel>

<div class="detailTable">
<table width="99%">
<tr>
    <td align="right">
        <strong>#{messages['question.detail.code']}</strong>
    </td>
    <td width="100%" colspan="3">
        <h:inputText id="nameInput"
                     value="#{pageBean.model.name }"
                     disabled="#{pageBean.viewMode}"
                     style="width:99%"/>
    </td>
</tr>
<tr>
    <td align="right">
        <strong>#{messages['question.detail.discipline.name']}</strong>
    </td>
    <td width="100%" colspan="3">
        <h:selectOneMenu id="disciplineSelect"
                         value="#{pageBean.discipline}"
                         disabled="#{pageBean.viewMode}"
                         converter="ru.spbspu.staub.ObjectSelectConverter"
                         styleClass="required"
                         required="true"
                         requiredMessage="#{messages['question.detail.required.discipline']}">
            <s:selectItems id="disciplineSelectItems"
                           value="#{pageBean.disciplineList}"
                           var="discipline"
                           label="#{discipline.name}"
                           noSelectionLabel=""/>
            <a4j:support id="disciplineSelectSupport"
                         event="onchange"
                         action="#{pageBean.refreshCategories}"
                         reRender="categorySelect"
                         ajaxSingle="true"/>
        </h:selectOneMenu>
    </td>
</tr>
<tr>
    <td align="right">
        <strong>#{messages['question.detail.category.name']}</strong>
    </td>
    <td width="100%" colspan="3">
        <h:selectOneMenu id="categorySelect"
                         value="#{pageBean.category}"
                         disabled="#{pageBean.viewMode or pageBean.discipline == null}"
                         converter="ru.spbspu.staub.ObjectSelectConverter"
                         styleClass="required"
                         required="true"
                         requiredMessage="#{messages['question.detail.required.category']}">
            <s:selectItems id="categorySelectItems"
                           value="#{pageBean.categoryList}"
                           var="category"
                           label="#{category.name}"
                           noSelectionLabel=""/>
            <a4j:support id="categorySelectSupport"
                         event="onchange"
                         action="#{pageBean.refreshTopics}"
                         reRender="topicSelect"
                         ajaxSingle="true"/>
        </h:selectOneMenu>
    </td>
</tr>
<tr>
    <td align="right">
        <strong>#{messages['question.detail.topic.name']}</strong>
    </td>
    <td width="100%" colspan="3">
        <h:selectOneMenu id="topicSelect"
                         value="#{pageBean.model.topic}"
                         disabled="#{pageBean.viewMode or pageBean.category == null}"
                         converter="ru.spbspu.staub.ObjectSelectConverter"
                         styleClass="required"
                         required="true"
                         requiredMessage="#{messages['question.detail.required.topic']}">
            <s:selectItems id="topicSelectItems"
                           value="#{pageBean.topicList}"
                           var="topic"
                           label="#{topic.name}"
                           noSelectionLabel=""/>
        </h:selectOneMenu>
    </td>
</tr>
<tr>
    <td align="right">
        <strong>#{messages['question.detail.difficulty.name']}</strong>
    </td>
    <td width="50%">
        <h:selectOneMenu id="difficultySelect"
                         value="#{pageBean.model.difficulty}"
                         disabled="#{pageBean.viewMode}"
                         converter="ru.spbspu.staub.ObjectSelectConverter"
                         styleClass="required"
                         required="true"
                         requiredMessage="#{messages['question.detail.required.difficulty']}">
            <s:selectItems id="difficultySelectItems"
                           value="#{pageBean.difficultyList}"
                           var="difficulty"
                           label="#{difficulty.name}"
                           noSelectionLabel=""/>
        </h:selectOneMenu>
    </td>
    <td align="right">
        <strong>#{messages['question.detail.timeLimit']}</strong>
    </td>
    <td width="50%">
        <h:inputText id="timeLimitInput"
                     value="#{pageBean.model.timeLimit}"
                     disabled="#{pageBean.viewMode}"
                     style="width:5em;"/>
    </td>
</tr>
<tr>
    <td colspan="4">
        <table class="innerDetailTable" cellpadding="0" cellspacing="0">
            <tr>
                <td align="left">
                    <strong>#{messages['question.detail.description']}</strong>
                </td>
                <td align="right">
                    <h:graphicImage id="previewIcon"
                                    url="/images/icons/icon_preview.gif"
                                    alt="#{messages['common.detail.functions.preview']}"
                                    styleClass="clickable">
                        <a4j:support id="previewIconSupport"
                                     event="onclick"
                                     reRender="previewModalBox"
                                     oncomplete="Richfaces.showModalPanel('previewModalBox')"
                                     process="questionDefinitionTextarea"
                                     ajaxSingle="true"/>
                    </h:graphicImage>
                    <h:graphicImage id="imageUploadIcon"
                                    url="/images/icons/icon_upload.gif"
                                    onclick="Richfaces.showModalPanel('imageUploadModalBox')"
                                    alt="#{messages['common.detail.functions.uploadImage']}"
                                    styleClass="clickable"/>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <h:inputTextarea id="questionDefinitionTextarea"
                                     value="#{pageBean.questionDefinition.description}"
                                     disabled="#{pageBean.viewMode}"
                                     style="width:99%; height:300px"
                                     required="true"
                                     requiredMessage="#{messages['question.detail.required.definition']}"/>
                </td>
            </tr>
        </table>
    </td>
</tr>
<tr>
    <td align="left">
        <strong>#{messages['question.detail.answers']}</strong>
    </td>
    <td width="50%"/>
    <td align="right">
        <strong>#{messages['question.detail.answerType']}</strong>
    </td>
    <td width="50%">
        <h:selectOneMenu id="answerTypesSelect"
                         value="#{pageBean.answerType}"
                         converter="ru.spbspu.staub.ObjectSelectConverter"
                         disabled="#{pageBean.viewMode}"
                         styleClass="required"
                         required="true"
                         requiredMessage="#{messages['question.detail.required.answerType']}">
            <s:selectItems id="answerTypesSelectItems"
                           var="type" value="#{pageBean.answerTypes}"
                           label="#{messages[fn:join('question.detail.answerType.', type)]}"
                           noSelectionLabel=""/>
            <a4j:support id="answerTypesSelectSupport"
                         event="onchange"
                         action="#{pageBean.changeAnswerType}"
                         reRender="correctAnswerPanel, answerLabelPanel"
                         ajaxSingle="true"/>
        </h:selectOneMenu>
    </td>
</tr>
<tr>
    <td>
        <a4j:outputPanel id="correctAnswerPanel">
            <h:selectOneRadio id="correctAnswerSingleChoice"
                              layout="pageDirection"
                              rendered="#{pageBean.answer.singleChoice}"
                              converter="ru.spbspu.staub.ObjectSelectConverter"
                              value="#{pageBean.answer.current}"
                              disabled="#{pageBean.viewMode}"
                              required="true"
                              requiredMessage="#{messages['question.detail.required.correctSingleChoice']}"
                              styleClass="radio">
                <s:selectItems id="correctAnswerSingleChoiceItems"
                               value="#{pageBean.answer.definition.answer}"
                               var="temp"/>
            </h:selectOneRadio>
            <h:selectManyCheckbox id="correctAnswerMultipleChoice"
                                  layout="pageDirection"
                                  rendered="#{pageBean.answer.multipleChoice}"
                                  converter="ru.spbspu.staub.ObjectSelectConverter"
                                  value="#{pageBean.answer.current}"
                                  disabled="#{pageBean.viewMode}"
                                  required="true"
                                  requiredMessage="#{messages['question.detail.required.correctMultipleChoice']}"
                                  styleClass="checkbox">
                <s:selectItems id="correctAnswerMultipleChoiceItems"
                               value="#{pageBean.answer.definition.answer}"
                               var="temp"/>
            </h:selectManyCheckbox>
            <h:inputText id="correctAnswerUserInput"
                         value="#{pageBean.answer.current}"
                         disabled="#{pageBean.viewMode}"
                         rendered="#{pageBean.answer.userInput}"
                         required="true"
                         requiredMessage="#{messages['question.detail.required.correctUserInput']}"/>
        </a4j:outputPanel>
    </td>
    <td colspan="2">
        <a4j:outputPanel id="answerLabelPanel">
            <table cellpadding="0" cellspacing="0">
                <a4j:repeat id="choiceRepeat"
                            value="#{pageBean.answer.definition.answer}"
                            var="answer"
                            rendered="#{pageBean.answer.singleChoice or pageBean.answer.multipleChoice}">
                    <tr>
                        <td>
                            <h:inputText id="choiceValueInput"
                                         value="#{answer.value}"
                                         disabled="#{pageBean.viewMode}"/>
                        </td>
                    </tr>
                </a4j:repeat>
            </table>
        </a4j:outputPanel>
    </td>
    <td align="right">
        <a4j:outputPanel id="answerButtonPanel">
            <a4j:commandButton id="addAnswerButton"
                               action="#{pageBean.answer.addAnswer}"
                               reRender="correctAnswerPanel,answerLabelPanel"
                               styleClass="buttonImage"
                               image="/images/icons/icon_add.gif"
                               disabled="#{pageBean.viewMode}"
                               rendered="#{pageBean.answer.choice}"
                               immediate="true"/>
            <rich:separator width="2px"/>
            <a4j:commandButton id="removeAnswerButton"
                               action="#{pageBean.answer.removeAnswer}"
                               reRender="correctAnswerPanel,answerLabelPanel"
                               styleClass="buttonImage"
                               image="/images/icons/icon_remove.gif"
                               disabled="#{pageBean.viewMode}"
                               rendered="#{pageBean.answer.choice}"
                               immediate="true"/>
        </a4j:outputPanel>
    </td>
</tr>
</table>
</div>
</a4j:form>
<rich:modalPanel id="imageUploadModalBox" zindex="1000" autosized="true">
    <f:facet name="header">
        Вставить изображение
    </f:facet>
    <h:form enctype="multipart/form-data">

        <rich:fileUpload fileUploadListener="#{questionDetailBean.fileUploadListener}">
            <a4j:support event="onuploadcomplete" reRender="imageUploadModalBox, questionDefinitionTextarea"
                         oncomplete="Richfaces.hideModalPanel('imageUploadModalBox');"/>
        </rich:fileUpload>

        <a4j:commandButton id="cancelUploadButton"
                           styleClass="button"
                           value="Отмена"
                           onclick="Richfaces.hideModalPanel('imageUploadModalBox'); return false;"/>
    </h:form>
</rich:modalPanel>
<rich:modalPanel id="previewModalBox" zindex="1000" autosized="true" width="500">
    <f:facet name="header">
        Предварительный просмотр
    </f:facet>

    <div id="questionDefinitionPanel" class="questionDefinitionPanel">
        <s:formattedText id="previewText"
                         value="#{pageBean.questionDefinition.description}"/>
    </div>

    <a4j:commandButton id="closePreviewButton"
                       styleClass="button"
                       value="Закрыть"
                       onclick="Richfaces.hideModalPanel('previewModalBox'); return false;"/>
</rich:modalPanel>
</ui:define>
</ui:composition>
</html>
